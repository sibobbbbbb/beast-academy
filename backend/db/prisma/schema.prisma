generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model member_user {
  u_id    Int
  m_id    Int
  members members @relation(fields: [m_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users   users   @relation(fields: [u_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([u_id, m_id])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model members {
  id            Int           @id @default(autoincrement())
  name          String        @default("") @db.VarChar(100)
  img_url       String        @default("")
  phone_no      String?       @unique @db.VarChar(15)
  email         String        @unique @db.VarChar(100)
  created_at    DateTime?     @default(now()) @db.Timestamp(6)
  last_activity DateTime?     @default(now()) @db.Timestamp(6)
  stat1         Int?          @default(0)
  stat2         Int?          @default(0)
  stat3         Int?          @default(0)
  stat4         Int?          @default(0)
  stat5         Int?          @default(0)
  activity      activity[]
  member_user   member_user[]
}

model users {
  id          Int           @id @default(autoincrement())
  role        user_role
  username    String        @db.VarChar(100)
  password    String?       @db.VarChar(255)  // Made nullable for social logins
  email       String        @unique @db.VarChar(100)
  provider    String?       @db.VarChar(20)   // 'google', 'facebook', etc.
  provider_id String?       @db.VarChar(100)  // ID from the provider
  avatar      String?       // Profile picture URL
  created_at  DateTime?     @default(now()) @db.Timestamp(6)
  updated_at  DateTime?     @default(now()) @updatedAt @db.Timestamp(6)
  member_user member_user[]
}

model events {
  id          Int       @id @default(autoincrement())
  title       String    @default("Event Title") @db.VarChar(50)
  images      String    @default("")
  description String?   @default("Description here") @db.VarChar(200)
  posted_at   DateTime? @default(now()) @db.Timestamp(6)
}

model activity {
  id       Int           @id @default(autoincrement())
  m_id     Int
  activity activity_type @default(other)
  date     DateTime      @default(now()) @db.Timestamp(6)
  members  members       @relation(fields: [m_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

enum user_role {
  admin
  trainer
  member
}

enum activity_type {
  tournament
  class
  friendlies
  other
}
