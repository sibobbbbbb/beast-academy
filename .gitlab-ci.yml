stages:
#   - lint
#   - test
#   - build
  - deploy 

# lint:
#   tags:
#     - runner-beast
#   image: node:20
#   stage: lint
#   before_script:
#     - cd frontend; if (-not $?) { exit 1 }
#     - npm install  
#   script:
#     - npm run lint
#   rules:
#     - if: '$CI_COMMIT_BRANCH == "main"'

# test:
#   tags:
#     - runner-beast
#   image: node:20
#   stage: test
#   before_script:
#     - cd backend; if (-not $?) { exit 1 }  
#     - npm install  
#     - npx prisma generate --schema=./db/prisma/schema.prisma
#   script:
#     - npm run test
#   rules:
#     - if: '$CI_COMMIT_BRANCH == "main"'

# build:
#   tags:
#     - runner-beast
#   image: node:20
#   stage: build
#   before_script:
#     - cd frontend; if (-not $?) { exit 1 }  
#     - npm install 
#   script:
#     - npm run build
#   artifacts:
#     paths:
#       - frontend/dist
#   rules:
#     - if: '$CI_COMMIT_BRANCH == "main"'

deploy_backend:
  tags:
    - runner-beast
  image: node:20
  stage: deploy
  script:
    - npm install -g @railway/cli
    - cd backend; if (-not $?) { exit 1 }
    - echo "Deploying backend to Railway..."
    - npx railway up --service=$RAILWAY_SERVICE_ID --environment=production
  environment:
    name: production
  variables:
    RAILWAY_TOKEN: "fe4ccbb1-7705-47bb-ad23-01f21ee226e2"
    RAILWAY_PROJECT_ID: "b817b5e2-210e-472f-b38f-16875f8eaec8"
    RAILWAY_SERVICE_ID: "f256a2e1-4cba-4682-921d-5dd45f304dd8"
  rules:
    - if: '$CI_COMMIT_BRANCH == "main"'